[
  {
    "objectID": "lab-03.html",
    "href": "lab-03.html",
    "title": "Lab 3: COVID-19",
    "section": "",
    "text": "Prep for lab 3\n\n# Load the necessary libraries\nlibrary(readr) \nlibrary(dplyr)  \n\n\nAttaching package: 'dplyr'\n\n\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n\n\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n\nlibrary(ggplot2)\nlibrary(lubridate)\n\n\nAttaching package: 'lubridate'\n\n\nThe following objects are masked from 'package:base':\n\n    date, intersect, setdiff, union\n\nlibrary(zoo)\n\n\nAttaching package: 'zoo'\n\n\nThe following objects are masked from 'package:base':\n\n    as.Date, as.Date.numeric\n\nlibrary(flextable)\n\n\n\nQuestion One :\nThe ability to have access to open data is extremely important as it gives equitable exposure to the trends within environmental science and health of society to the publics. It ensures that all the information we are being fed through the news has the accountability of transparency because we can fact check it for ourselves if its open data.\n\n\nQuestion Two :\n\ncovid = read_csv('https://raw.githubusercontent.com/nytimes/covid-19-data/master/us-counties.csv') \n\nRows: 2502832 Columns: 6\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr  (3): county, state, fips\ndbl  (2): cases, deaths\ndate (1): date\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n\n# Creating Objects\n\ntxt &lt;- \"2022-02-01\"\nclass(txt)\n\n[1] \"character\"\n\nmy.date &lt;- as.Date(\"2022-02-01\")\nmy.state &lt;- \"Colorado\"\n\n# Start by making a subset that limits (filter) the data to Colorado and add a new column (mutate) with the daily new cases using diff/lag by county (group_by). Do the same for new deaths as well.\n\ncolorado &lt;- covid |&gt;\n  filter(state == \"Colorado\") |&gt;\n  group_by(county)|&gt;\n  arrange(date) |&gt;\n  mutate(new_cases = cases - lag(cases),\n         new_deaths = deaths - lag(deaths)) |&gt;\n  ungroup() \n\n# Using your subset, generate (2) tables. The first should show the 5 counties with the most CUMULATIVE cases, and the second should show the 5 counties with the most NEW cases. Remember to use your my.date object as a proxy for today’s date\n  \nfilter(colorado, date == my.date) |&gt;\n  slice_max(cases, n=5) |&gt;\n  select(Date = date, County = county, Cases = cases) |&gt;\n  flextable() |&gt;\n  add_header_lines(\"Most Total Cases\")\n\nMost Total CasesDateCountyCases2022-02-01El Paso170,6732022-02-01Denver159,0222022-02-01Arapahoe144,2552022-02-01Adams126,7682022-02-01Jefferson113,240\n\nfilter(colorado, date == my.date) |&gt;\n  slice_max(cases, n=5) |&gt;\n  select(Date = date, County = county, Cases = new_cases) |&gt;\n  flextable() |&gt;\n  add_header_lines(\"Most New Cases\")\n\nMost New CasesDateCountyCases2022-02-01El Paso6302022-02-01Denver3892022-02-01Arapahoe4012022-02-01Adams3262022-02-01Jefferson291\n\n\n\n\nQuestion Three:\n\n# Populating more data\n\npop_url &lt;- 'https://www2.census.gov/programs-surveys/popest/datasets/2020-2023/counties/totals/co-est2023-alldata.csv'\n\n# Given the above URL, and guidelines on string concatenation and formatting, read in the population data and (1) create a five digit FIP variable and only keep columns that contain “NAME” or “2021” (remember the tidyselect option found with ?dplyr::select). Additionally, remove all state level rows (e.g. COUNTY FIP == “000”)\n\npop &lt;- read.csv(pop_url) |&gt;\n  filter(COUNTY !=0) |&gt;\n  mutate(fips = paste0(sprintf(\"%02d\", STATE),\n                       sprintf(\"%03d\", COUNTY))) |&gt;\n  select(fips, contains('NAME'), contains('2021'))\n\n# Now, explore the data … what attributes does it have, what are the names of the columns? Do any match the COVID data we have? What are the dimensions… In a few sentences describe the data obtained after modification:\n\nnames(pop)\n\n [1] \"fips\"                  \"STNAME\"                \"CTYNAME\"              \n [4] \"POPESTIMATE2021\"       \"NPOPCHG2021\"           \"BIRTHS2021\"           \n [7] \"DEATHS2021\"            \"NATURALCHG2021\"        \"INTERNATIONALMIG2021\" \n[10] \"DOMESTICMIG2021\"       \"NETMIG2021\"            \"RESIDUAL2021\"         \n[13] \"GQESTIMATES2021\"       \"RBIRTH2021\"            \"RDEATH2021\"           \n[16] \"RNATURALCHG2021\"       \"RINTERNATIONALMIG2021\" \"RDOMESTICMIG2021\"     \n[19] \"RNETMIG2021\"          \n\ndim(pop)\n\n[1] 3144   19\n\nnrow(pop)\n\n[1] 3144\n\nstr (pop)\n\n'data.frame':   3144 obs. of  19 variables:\n $ fips                 : chr  \"01001\" \"01003\" \"01005\" \"01007\" ...\n $ STNAME               : chr  \"Alabama\" \"Alabama\" \"Alabama\" \"Alabama\" ...\n $ CTYNAME              : chr  \"Autauga County\" \"Baldwin County\" \"Barbour County\" \"Bibb County\" ...\n $ POPESTIMATE2021      : int  59203 239439 24533 22359 59079 10143 18890 115678 34488 25074 ...\n $ NPOPCHG2021          : int  288 6212 -436 171 -28 -86 -135 -565 -163 105 ...\n $ BIRTHS2021           : int  686 2337 270 240 654 111 227 1250 392 254 ...\n $ DEATHS2021           : int  696 2948 390 325 875 160 297 1843 592 442 ...\n $ NATURALCHG2021       : int  -10 -611 -120 -85 -221 -49 -70 -593 -200 -188 ...\n $ INTERNATIONALMIG2021 : int  15 105 0 1 9 1 5 12 22 7 ...\n $ DOMESTICMIG2021      : int  242 6972 -313 254 141 -42 -75 -70 -6 284 ...\n $ NETMIG2021           : int  257 7077 -313 255 150 -41 -70 -58 16 291 ...\n $ RESIDUAL2021         : int  41 -254 -3 1 43 4 5 86 21 2 ...\n $ GQESTIMATES2021      : int  484 3351 2248 1994 616 1578 285 5407 856 278 ...\n $ RBIRTH2021           : num  11.62 9.89 10.91 10.78 11.07 ...\n $ RDEATH2021           : num  11.8 12.5 15.8 14.6 14.8 ...\n $ RNATURALCHG2021      : num  -0.169 -2.585 -4.848 -3.816 -3.74 ...\n $ RINTERNATIONALMIG2021: num  0.254 0.4443 0 0.0449 0.1523 ...\n $ RDOMESTICMIG2021     : num  4.1 29.5 -12.65 11.4 2.39 ...\n $ RNETMIG2021          : num  4.35 29.95 -12.65 11.45 2.54 ...\n\n## Answer: There are 3,144 observations within 19 variables, of which the first 3 column observations are character types,the next 10 are integer types, and the last six are number types.The names of the columns goes as follows: fips, state name, city name, population estimate in 2021, population change in 2021, births in 2021, deaths in 2021, natural change in 2021, international migration in 2021, domestic change in 2021, net migration in 2021, residual for 2021, GQ estimate for 2021, birth rates in 2021, death rates in 2021, natural change rates in 2021, international migration rates in 2021, domestic migration rates in 2021, and the net migration rates in 2021. \n\n# What is the range of populations seen in Colorado counties in 2021:\n\nrange(pop$POPESTIMATE2021)\n\n[1]      54 9809462\n\n## Answer: The range of populations in CO counties in 2021 is from 54 to 9,809,462\n\n\n# Join the population data to the Colorado COVID data and compute the per capita cumulative cases, per capita new cases, and per capita new deaths:\n\npop2 &lt;- pop |&gt;\n  rename(state = STNAME)\n\nperCap = inner_join(colorado, select(pop,\n                                     fips,\n                                     pop = POPESTIMATE2021),\n                    by = 'fips') |&gt;\n  filter(date == my.date) |&gt;\n  mutate(cumPerCap = cases / pop,\n         newCasesPerCap = new_cases / pop,\n         newDeathsPerCap = new_deaths / pop)\n\nperCap |&gt;\n  summarize(totalcumulativecases = sum(cumPerCap),\n            totalnewcases = sum(newCasesPerCap),\n            totalnewdeaths = sum(newDeathsPerCap))\n\n# A tibble: 1 × 3\n  totalcumulativecases totalnewcases totalnewdeaths\n                 &lt;dbl&gt;         &lt;dbl&gt;          &lt;dbl&gt;\n1                 13.8        0.0554       0.000358\n\n## Answer: The newly computed values of per capita cumulative cases in 2021 are 13.8, new cases are 0.05, and new deaths are 0.00036. \n\n\n# Generate (2) new tables. The first should show the 5 counties with the most cumulative cases per capita on 2021-02-01, and the second should show the 5 counties with the most NEW cases per capita on the same date. Your tables should have clear column names and descriptive captions.\n\nperCap |&gt;\n  select(County = county, Cases = cumPerCap) |&gt;\n  slice_max(Cases, n=5) |&gt;\n  flextable() |&gt;\n  add_header_lines(\"Most Cumulative Cases Per Capita\")\n\nMost Cumulative Cases Per CapitaCountyCasesCrowley0.5117698Bent0.4118749Pitkin0.3429659Lincoln0.3424082Logan0.3047701\n\nperCap |&gt; \n  select(County = county, Cases = newCasesPerCap) |&gt;\n  slice_max(Cases, n=5) |&gt;\n  flextable() |&gt;\n  add_header_lines(\"Most New Cases Per Capita\")\n\nMost New Cases Per CapitaCountyCasesCrowley0.009764603Bent0.004120622Sedgwick0.003869304Washington0.002875924Las Animas0.002651039\n\n\n\n\nQuestion Four :\n\n# Filter the merged COVID/Population data to only include the last 14 days. Remember this should be a programmatic request and not hard-coded. Then, use the group_by/summarize paradigm to determine the total number of new cases in the last 14 days per 100,000 people. Print a table of the top 5 counties, and, report the number that meet the watch list condition: “More than 100 new cases per 100,000 residents over the past 14 days…”\n\nsafe &lt;- pop2 |&gt;\n  inner_join(colorado, by = \"fips\") |&gt;\n  filter(between(date, my.date - 13, my.date)) |&gt;\n  group_by(county) |&gt;\n  summarize(lag = sum(new_cases)/(POPESTIMATE2021[1]/100000)) |&gt;\n  ungroup()\n\nsafe |&gt;\n  select(County = county, Cases = lag) |&gt;\n  slice_max(Cases, n = 5) |&gt;\n  flextable() |&gt;\n  add_header_lines(\"Cases per 100,000 in the last 14 days\")\n\nCases per 100,000 in the last 14 daysCountyCasesCrowley3,923.278Lincoln3,599.488Alamosa3,594.909Mineral3,336.921Conejos3,152.203\n\n\n\n\nQuestion Five:\n\n# Given we are assuming it is February 1st, 2022. Your leadership has asked you to determine what percentage of deaths in each county were attributed to COVID last year (2021). You eagerly tell them that with the current Census data, you can do this!\n\n# From previous questions you should have a data.frame with daily COVID deaths in Colorado and the Census based, 2021 total deaths. For this question, you will find the ratio of total COVID deaths per county (2021) of all recorded deaths. In a plot of your choosing, visualize all counties where COVID deaths account for 20% or more of the annual death toll.\n\ntmp.date = as.Date(\"2022-02-01\")\n\nlubridate::year(tmp.date)\n\n[1] 2022\n\nlubridate::month(tmp.date)\n\n[1] 2\n\nlubridate::yday(tmp.date)\n\n[1] 32\n\nx &lt;- colorado |&gt;\n  mutate(year = lubridate::year(date)) |&gt;\n  filter(year == 2021) |&gt;\n  group_by(fips) |&gt;\n  summarize(totdeaths = sum(new_deaths, na.rm = TRUE)) |&gt;\n  left_join(pop, by = c(\"fips\")) |&gt;\n  mutate(death_ratio = 100 * (totdeaths / DEATHS2021)) |&gt;\n  select(CTYNAME, totdeaths, DEATHS2021, death_ratio) |&gt;\n  filter(death_ratio &gt; 20)\n\nggplot(x) +\n  geom_col(aes(x = death_ratio, y = CTYNAME)) +\n  theme_light()\n\n\n\n\n\n\n\n\n###Question Six :\n\n# First, we need to group/summarize our county level data to the state level, filter it to the four states of interest, and calculate the number of daily new cases (diff/lag) and the 7-day rolling mean.\n\nstate_covid = covid |&gt;\n  group_by(date, state) |&gt;\n  summarize(cases = sum(cases)) |&gt;\n  filter(state %in% c(\"New York\", \"Ohio\", \"Colorado\", \"Alabama\")) |&gt;\n  group_by(state) |&gt;\n  mutate(NewCases = cases - lag(cases),\n         roll = zoo::rollmean(NewCases, k = 7, align = \"right\", fill = NA)) |&gt;\n  ungroup()\n\n`summarise()` has grouped output by 'date'. You can override using the\n`.groups` argument.\n\n# Using the modified data, make a facet plot of the daily new cases and the 7-day rolling mean. Your plot should use compelling geoms, labels, colors, and themes. \n\nggplot(state_covid, aes(x = date)) +\n  geom_col(aes(y = NewCases), fill = \"blue\", col = NA) +\n  geom_line(aes(y = roll), col = \"pink\", size = 1) +\n  theme_linedraw() +\n  facet_wrap(~state, nrow = 2, scales = \"free_y\") +\n  labs(title = \"Cumulative COVID Cases\", x = \"Date\", y = \"Case Count\")\n\nWarning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.\nℹ Please use `linewidth` instead.\n\n\nWarning: Removed 4 rows containing missing values or values outside the scale range\n(`geom_col()`).\n\n\nWarning: Removed 7 rows containing missing values or values outside the scale range\n(`geom_line()`).\n\n\n\n\n\n\n\n\n# The story of raw case counts can be misleading. To understand why, lets explore the cases per capita of each state. To do this, join the state COVID data to the population estimates and calculate the newcases/totalpopulation. Additionally, calculate the 7-day rolling mean of the new cases per capita counts. This is a tricky task and will take some thought, time, and modification to existing code (most likely)! Hint: You may need to modify the columns you kept in your original population data. Be creative with how you join data (inner vs outer vs full)!\n\nstate_capita &lt;- inner_join(state_covid, pop2, by = \"state\") |&gt;\n  filter(date == my.date) |&gt;\n  mutate(cumPerCap = cases / POPESTIMATE2021,\n         newCasesPerCap = NewCases / POPESTIMATE2021)\n\nWarning in inner_join(state_covid, pop2, by = \"state\"): Detected an unexpected many-to-many relationship between `x` and `y`.\nℹ Row 1 of `x` matches multiple rows in `y`.\nℹ Row 1831 of `y` matches multiple rows in `x`.\nℹ If a many-to-many relationship is expected, set `relationship =\n  \"many-to-many\"` to silence this warning.\n\nstate_capita |&gt;\n  filter(state == \"Colorado\") |&gt;\n  summarize(sum(newCasesPerCap))\n\n# A tibble: 1 × 1\n  `sum(newCasesPerCap)`\n                  &lt;dbl&gt;\n1                  41.4\n\nstate_capita |&gt;\n  filter(state == \"Alabama\") |&gt;\n  summarize(sum(newCasesPerCap))\n\n# A tibble: 1 × 1\n  `sum(newCasesPerCap)`\n                  &lt;dbl&gt;\n1                  14.5\n\nstate_capita |&gt;\n  filter(state == \"Ohio\") |&gt;\n  summarize(sum(newCasesPerCap))\n\n# A tibble: 1 × 1\n  `sum(newCasesPerCap)`\n                  &lt;dbl&gt;\n1                  12.0\n\nstate_capita |&gt;\n  filter(state == \"New York\") |&gt;\n  summarize(sum(newCasesPerCap))\n\n# A tibble: 1 × 1\n  `sum(newCasesPerCap)`\n                  &lt;dbl&gt;\n1                  6.44\n\n## Answer: These steps have created new cases per capita in the states Colorado, Alabama, Ohio, and New York. The new numbers are 41.4 for Colorado, 14.5 for Alabama, 11.9 for Ohio, and 6.4 for New York. \n\nls(state_capita)\n\n [1] \"BIRTHS2021\"            \"cases\"                 \"CTYNAME\"              \n [4] \"cumPerCap\"             \"date\"                  \"DEATHS2021\"           \n [7] \"DOMESTICMIG2021\"       \"fips\"                  \"GQESTIMATES2021\"      \n[10] \"INTERNATIONALMIG2021\"  \"NATURALCHG2021\"        \"NETMIG2021\"           \n[13] \"NewCases\"              \"newCasesPerCap\"        \"NPOPCHG2021\"          \n[16] \"POPESTIMATE2021\"       \"RBIRTH2021\"            \"RDEATH2021\"           \n[19] \"RDOMESTICMIG2021\"      \"RESIDUAL2021\"          \"RINTERNATIONALMIG2021\"\n[22] \"RNATURALCHG2021\"       \"RNETMIG2021\"           \"roll\"                 \n[25] \"state\"                \n\nperCapNewCasesRoll = state_capita |&gt;\n  group_by(date, state) |&gt;\n  filter(state %in% c(\"New York\", \"Ohio\", \"Colorado\", \"Alabama\")) |&gt;\n  group_by(state) |&gt;\n  mutate(newnewCasesPerCap = mean(sum(newCasesPerCap)),\n         roll = zoo::rollmean(newCasesPerCap, k = 7, align = \"right\", fill = NA)) |&gt;\n  ungroup()\n\nperCapNewCasesRoll &lt;- perCapNewCasesRoll |&gt;\n  select(-CTYNAME)\n\n## Answer: This code has calculated the seven-day rolling mean into a new column named perCapNewCasesRoll\n\n\n#Using the per capita data, plot the 7-day rolling averages overlying each other (one plot) with compelling labels, colors, and theme. \n\nstate_capita2 &lt;- inner_join(state_covid, pop2, by = \"state\") |&gt;\n  mutate(cumPerCap = cases / POPESTIMATE2021,\n         newCasesPerCap = NewCases / POPESTIMATE2021)\n\nWarning in inner_join(state_covid, pop2, by = \"state\"): Detected an unexpected many-to-many relationship between `x` and `y`.\nℹ Row 1 of `x` matches multiple rows in `y`.\nℹ Row 1831 of `y` matches multiple rows in `x`.\nℹ If a many-to-many relationship is expected, set `relationship =\n  \"many-to-many\"` to silence this warning.\n\nperCapNewCasesRoll2 = state_capita2 |&gt;\n  group_by(date, state) |&gt;\n  filter(state %in% c(\"New York\", \"Ohio\", \"Colorado\", \"Alabama\")) |&gt;\n  group_by(state) |&gt;\n  mutate(newnewCasesPerCap = mean(sum(newCasesPerCap)),\n         roll = zoo::rollmean(newCasesPerCap, k = 7, align = \"right\", fill = NA)) |&gt;\n  ungroup()\n\nperCapNewCasesRoll2 &lt;- perCapNewCasesRoll2 |&gt;\n  select(-CTYNAME)\n\nggplot(perCapNewCasesRoll2, aes(x = date)) +\n  geom_line(aes(y = roll, color = state), size = 1) +  \n  theme_linedraw() +\n  scale_color_manual(values = c(\"red\", \"blue\", \"green\", \"orange\")) +\n  labs(title = \"7-Day Rolling Averages of New Cases\", \n       x = \"Date\", y = \"New Cases Per Capita\")\n\nWarning: Removed 305 rows containing missing values or values outside the scale range\n(`geom_line()`).\n\n\n\n\n\n\n\n\n# Briefly describe the influence scaling by population had on the analysis? Does it make some states look better? Some worse? How so?\n\n## Answer: The ability to overlay and scale the graphs put it into a better perspective to compare the states' seven day rolling average. The plot before made it look like New York and Ohio had the most amount of cases but the second plot shows that Colorado had the most cases in reality.\n\n\n\nQuestion Seven :\n\n# Please read in the data (readr::read_csv()); and join it to your raw COVID-19. For each date, calculate the Weighted Mean Xcoord and Ycoord and using the daily  cumulative cases and the weight. In addition, calculate the total cases for each day, as well as the month. \n\nspatialdata = read_csv('https://raw.githubusercontent.com/mikejohnson51/csu-ess-330/refs/heads/main/resources/county-centroids.csv') |&gt;\n  inner_join(covid) |&gt;\n  group_by(date) |&gt;\n  summarize(Cases_WeightedMean_x = sum(LON*cases) / sum(cases),\n            Cases_WeightedMean_y = sum(LAT*cases) / sum(cases),\n            cases = sum(cases)) |&gt;\n  arrange(date) |&gt;\n  mutate(Month = format(date, \"%m\")) |&gt;\n  mutate(d = 1:n())\n\nRows: 3221 Columns: 3\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (1): fips\ndbl (2): LON, LAT\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\nJoining with `by = join_by(fips)`\n\n# Plot the weighted mean center (aes(x = LNG, y = LAT)), colored by month, and sized by total cases for each day. These points should be plotted over a map of the USA states which can be added to a ggplot object with: borders(\"state\", fill = \"gray90\", colour = \"white\")\n\nggplot(spatialdata) +\n  borders(\"state\", fill = \"gray90\", colour = \"white\") +\n  geom_point(aes(x = Cases_WeightedMean_x, y = Cases_WeightedMean_y), \n             color = \"red\", alpha = 0.25) +\n  labs(color = \"Month\",\n       size = \"cases\", \n       x = \"Longitude\", y = \"Latitude\", \n       title = \"Weighted Center of Covid-19 Cases\") +\n  theme(legend.position = \"none\")\n\n\n\n\n\n\n\n# In a few sentences, describe the movement of the COVID-19 weighted mean throughout the USA and possible drivers of its movement given your knowledge of the outbreak hot spots.\n\n## Answer: The movement of Covid-19 through its weighted mean across the US depicted in the graph just created shows it mainly around central america and in the Midwest. I can assume possible drivers of this pattern is due to travel and areas where bulk of citizens didn't believe in mask usage or sanitary protocols to reduce the spread of the virus."
  }
]